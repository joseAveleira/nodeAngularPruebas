(function () {
    'use strict';
    // Aquí irá la funcionalidad

    angular.module('blog', ['ngRoute', 'blog.controllers', 'blog.templates']);

    function config($locationProvider, $routeProvider) {
        $locationProvider.html5Mode(true);
        $routeProvider
            .when('/', {
                templateUrl: 'views/post-list.tpl.html',
                controller: 'PostListController',
                controllerAs: 'postlist'
            })
            .when('/post/:postId', {
                templateUrl: 'views/post-detail.tpl.html',
                controller: 'PostDetailController',
                controllerAs: 'postdetail'
            })
            .when('/new', {
                templateUrl: 'views/post-create.tpl.html',
                controller: 'PostCreateController',
                controllerAs: 'postcreate'
            });
    }
    angular
        .module('blog')
        .config(config);
})();


(function () {
    'use strict';
    angular
        .module('blog.controllers', ['blog.services']);

    function PostListController(Post) {
        this.posts = Post.query();
    }

    function PostCreateController(Post) {
        var self = this;
        this.create = function () {
            Post.save(self.post);
        };
    }

    function PostDetailController($routeParams, Post, Comment,User) {
        this.post = {};
        this.comments = {};
        this.user = {};
        var self = this; // Para guardar la referencia
        Post.query({
                id: $routeParams.postId
            })
            .$promise.then(
                //Success
                function (data) {
                    self.post = data[0];
                    self.user = User.query({
                        id: self.user.userId
                    });
                },
                //Error
                function (error) {
                    console.log(error);
                }
            );
        this.comments = Comment.query({
            postId: $routeParams.postId
        });
    }

    angular
        .module('blog.controllers')
        .controller('PostListController', PostListController)
        .controller('PostCreateController', PostCreateController)
        .controller('PostDetailController', PostDetailController);

})();
(function () {
    'use strict';
    angular.module('blog.services', ['ngResource']);

    function Post($resource, BaseUrl) {
        return $resource(BaseUrl + '/posts/:postId', {
            postId: '@_id'
        });
    }
    function Comment($resource, BaseUrl) {
        return $resource(BaseUrl + '/comments/:commentId', {
            commentId: '@_id'
        });
    }
    function User($resource, BaseUrl) {
        return $resource(BaseUrl + '/users/:userId', {
            userId: '@_id'
        });
    }
    angular
        .module('blog.services')
        .constant('BaseUrl', 'http://jsonplaceholder.typicode.com')
        .factory('Post', Post)
        .factory('Comment', Comment)
        .factory('User', User);
})();
angular.module("blog.templates", []).run(["$templateCache", function($templateCache) {$templateCache.put("views/post-create.tpl.html","<section>\r\n    <form name=\"createPost\" role=\"form\" ng-submit=\"postcreate.create()\">\r\n        <fieldset class=\"form-group\">\r\n            <input class=\"form-control input-lg\" type=\"text\" placeholder=\"Título del Post\" ng-model=\"postcreate.post.title\">\r\n        </fieldset>\r\n        <fieldset class=\"form-group\">\r\n            <textarea class=\"form-control input-lg\" placeholder=\"Texto del Post\" ng-model=\"postcreate.post.text\"></textarea>\r\n        </fieldset>\r\n        <hr>\r\n        <button class=\"btn btn-primary btn-lg\" type=\"submit\" ng-disabled=\"!createPost.$valid\">\r\n            <span class=\"fa fa-rocket\"> Publicar</span>\r\n        </button>\r\n    </form>\r\n</section>");
$templateCache.put("views/post-detail.tpl.html","<article class=\"blog-post\">\r\n    <header class=\"blog-post-header\">\r\n        <h1>{{ postdetail.post.title }}</h1>\r\n    </header>\r\n    <p class=\"blog-post-body\">\r\n        {{ postdetail.post.body }}\r\n    </p>\r\n    <p>\r\n        Escrito por: <strong>{{ postdetail.user[0].name }}</strong>\r\n        <span class=\"fa fa-mail\"></span> {{ postdetail.user[0].email }}\r\n    </p>\r\n</article>\r\n<aside class=\"comments\">\r\n    <header class=\"comments-header\">\r\n        <h3>\r\n<span class=\"fa fa-comments\"></span>\r\nCommentarios\r\n</h3>\r\n    </header>\r\n    <ul class=\"comments-list\">\r\n        <li class=\"comment-item\" ng-repeat=\"comment in postdetail.comments\">\r\n            <span class=\"fa fa-user\"></span>\r\n            <span class=\"comment-author\">{{ comment.email }}</span>\r\n            <p class=\"comment-body\">\r\n                {{ comment.body }}\r\n            </p>\r\n        </li>\r\n    </ul>\r\n</aside>");
$templateCache.put("views/post-list.tpl.html","<ul class=\"blog-post-list\">\r\n    <li class=\"blog-post-link\" ng-repeat=\"post in postlist.posts\">\r\n        <a ng-href=\"/post/{{ post.id }}\">{{ post.title }}</a>\r\n    </li>\r\n</ul>");}]);
